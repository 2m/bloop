<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta name="generator" content="Hugo 0.30.2" />
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> Developer documentation </title>

  
  <meta name="description" content="A contributors guide for Bloop."> 
  
  
  
  
  

  

  <meta name="author" content="Scala Center">


  <meta property="og:title" content="Developer documentation" />
<meta property="og:description" content="A contributors guide for Bloop." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://scalacenter.github.io/bloop/docs/developer-documentation/" />



<meta property="article:published_time" content="2018-02-20T13:45:00&#43;01:00"/>

<meta property="article:modified_time" content="2018-02-20T13:45:00&#43;01:00"/>











  




  
  
  
  
  

  <link rel="canonical" href="https://scalacenter.github.io/bloop/docs/developer-documentation/">  

  
<link rel="shortcut icon" type="image/png" href="data:image/png;base64,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">

  <link href="/bloop/css/font.css" rel="stylesheet" type="text/css">
  <link href="/bloop/css/kube.min.css" rel="stylesheet" type="text/css">
  <link href="/bloop/css/kube.legenda.css" rel="stylesheet" type="text/css">
  <link href="/bloop/css/highlight.css" rel="stylesheet" type="text/css">
  <link href="/bloop/css/master.css" rel="stylesheet" type="text/css">
  <link href="/bloop/css/kube.demo.css" rel="stylesheet" type="text/css">

 <link href="/bloop/css/custom.css" rel="stylesheet" type="text/css">
  <link href="https://afeld.github.io/emoji-css/emoji.css" rel="stylesheet">


  <script src="/bloop/js/jquery-2.1.4.min.js" type="text/javascript">
  </script>

  <script type="text/javascript" src="/bloop/js/tocbot.min.js"></script>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
</head>


<body class="page-kube">
  <header> <div class="show-sm">
    <div id="nav-toggle-box">
      <div id="nav-toggle-brand">
        <a href="/bloop/">Bloop</a>
      </div><a data-component="toggleme" data-target="#top" href="#" id="nav-toggle"><i class="kube-menu"></i></a>
    </div>
  </div>
  <div class="hide-sm" id="top">
    <div id="top-brand">
      <a href="/bloop/" title="Bloop">
        <img alt="bloop-logo" width="40px" src="/bloop/img/logo.png">
      </a>
    </div>
    <nav id="top-nav-main">
      <ul>
       
       
    <li><a href="/bloop/docs/" >Docs</a></li>
    
    <li><a href="/bloop/faq/" >Faq</a></li>
    
      </ul>
    </nav>
    <nav id="top-nav-extra"> 
      <ul>
          <li>
            <form class="form">
              <div class="form-item">
                <input type="text" id="bloop-search" id="bloop-search-input" placeholder="Search in docs">
              </div>
            </form>
          </li>
         
          <li>
            <a class="button secondary outline" href="https://github.com/scalacenter/bloop">View on GitHub</a>
          </li>
          
      </ul>
    </nav>
  </div>
 </header>
  <main>
  <div id="main">
    <div id="hero">
      <h1> Developer documentation </h1>
      <p class="hero-lead">
           Learn how to contribute to bloop in a nutshell..
      </p>
      <div style="padding-top: 30px; text-align: center;">
<a class="button outline" href="https://github.com/scalacenter/bloop/edit/master/website/content/docs/developer-documentation.md">Edit this page on GitHub</a>
</div>

    </div> 
    <div id="kube-component" class="content">
    
<nav id="contents">
    <ol class="js-toc">
    </ol>
</nav>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded",
function(){
tocbot.init({

tocSelector: '.js-toc',

contentSelector: '.content',

headingSelector: 'h2'
})
}
);
</script>



    

<p>This is all the documentation that is relevant for the developers of Bloop and
anyone who would like to contribute to Bloop.</p>

<h2 id="improving-the-docs">Improving the docs</h2>

<p>Our documentation infrastructure uses the <a href="http://gohugo.io/">Hugo</a> static site
generator, together with a custom version of the <a href="https://kube.elemnts.org/">Kube</a>
theme. The docs live in the <code>website/</code> folder in our repository.</p>

<p>If you want to make changes to the theme or how the documents are organised (think html or css), head to Scala Center&rsquo;s fork of <a href="https://github.com/scalacenter/kube">Kube</a> to make the changes and make a pull request.</p>

<p>If you want to make changes to the contents of the docs, you can click on the
&ldquo;Edit on GitHub&rdquo; button in every documentation page or, alternatively, make the
change in your local copy of Bloop&rsquo;s git repository. All documentation pages
live in <code>website/content/docs/</code>.</p>

<p>We recommend that whenever you make changes to the docs you add <code>[DOCS]</code> to the
commit message to tell the CI server to skip tests and speed up the merge
process.</p>

<h2 id="opening-up-our-sbt-build">Opening up our sbt build</h2>

<p>Bloop builds with sbt. Run sbt in the base directory to load the project.</p>

<h2 id="building-bloop-locally">Building Bloop locally</h2>

<p>The following sequence of commands is sufficient to build Bloop, publish it
locally on your machine and generate the binaries that you can immediately run:</p>

<pre><code class="language-sh">$ git clone --recursive https://github.com/scalacenter/bloop.git
$ cd bloop
$ sbt
&gt; install
&gt; frontend/version # copy this version number as &lt;version&gt;
$ cd nailgun
$ git rev-parse HEAD # copy this commit SHA as &lt;nailgun-commit-sha&gt;
$ cd ..
$ grep 'val coursierVersion' project/Dependencies.scala # copy this version number as &lt;coursier-version&gt;
# paste the version numbers and SHA obtained above in the following command:
$ bin/install.py --dest $HOME/.bloop --nailgun &lt;nailgun-commit-sha&gt; --coursier &lt;coursier-version&gt; --version &lt;version&gt;
</code></pre>

<h2 id="running-our-test-suite">Running our test suite</h2>

<p>Bloop has a rich integration test suite that requires build definitions to
exist to be able to compile a project. These build definitions are
machine-specific and they need to be created on the fly.</p>

<p>Before running the test suite, it is necessary to ensure that these build
definitions exist and are up-to-date with the following sbt task:</p>

<pre><code>&gt; frontend/integrationSetUpBloop
</code></pre>

<p>This will clone several open source projects and use the sbt-bloop plugin to
generate the build definitions. Then, run tests with:</p>

<pre><code>&gt; frontend/test
</code></pre>

<h2 id="running-our-community-build">Running our community build</h2>

<p>A community build is a collection of builds for which we test against on every
major change in bloop. It helps us keep track of potential regressions in both
correctness and performance.</p>

<p>Right now, our community build counts with several sbt 0.13 and 1.0 builds. As
running the community, build takes a while, it&rsquo;s run only before releases and
on major breaking changes.</p>

<h3 id="running-the-community-build-on-a-pull-request">Running the community build on a pull request</h3>

<p>The community build on every pull request with the label <code>community-build</code>.</p>

<h3 id="running-the-community-build-locally">Running the community build locally</h3>

<p>Run the community build locally by setting the <code>RUN_COMMUNITY_BUILD</code>
environment variable before running the tests locally.</p>

<pre><code>$ export RUN_COMMUNITY_BUILD=true
$ sbt &quot;frontend/testOnly bloop.tasks.IntegrationTestSuite&quot;
</code></pre>

<h2 id="running-our-benchmarks">Running our benchmarks</h2>

<p>Bloop features a benchmark suite to measure how fast Bloop is to perform
several operations (loading projects for instance), as well as other benchmark
that compare the compilation speed of Bloop against scalac and sbt. The
benchmarks run on a dedicated machine located at EPFL.</p>

<h3 id="overview">Overview</h3>

<p>Our benchmark infrastructure is composed of several pieces:</p>

<ul>
<li><a href="https://github.com/scala/compiler-benchmark">scala/compiler-benchmark</a>. Our fork can be
found at <a href="https://github.com/scalacenter/compiler-benchmark">scalacenter/compiler-benchmark</a>.</li>
<li>The benchmark-listened, which listens to comments on PR saying <code>test performance please</code>. This
is adapted from Dotty&rsquo;s <a href="https://github.com/liufengyun/bench]">liufengyun/bench</a>. Our fork can
be found at
<a href="https://github.com/scalacenter/bloop-benchmark-listener">scalacenter/bloop-benchmark-listener</a>.</li>
<li>InfluxDB and Grafana instances running on a machine at EPFL. This machine collects the
benchmark results and displays them on graphs. At this time, it is only accessible from
within EPFL&rsquo;s network.</li>
</ul>

<h3 id="running-the-benchmarks-on-a-pull-request">Running the benchmarks on a pull request</h3>

<p>Schedule the benchmarks in a given pull request by adding a comment that
contains &ldquo;test performance please&rdquo;. <a href="https://github.com/bloopoid">bloopoid</a>
will then kick in and confirm your request.</p>

<h3 id="running-the-benchmarks-locally">Running the benchmarks locally</h3>

<p><code>bin/run-benchmarks.sh</code> builds a specified version of Bloop (via CLI) and runs
the benchmarks for it. Run it to execute the benchmark suite locally, but keep
in mind that you must make sure your machine is stable and has been tweaked to
get stable results.</p>

<h2 id="debugging">Debugging</h2>

<p>If you&rsquo;re trying to catch a bug, it might be convenient to attach a debugger
to Bloop instead of creating your own tests and <code>println</code>ing.</p>

<p>In order to attach a debugger you need to run Bloop with some additional JVM
options to enable debugging in the first place. Here we use the standard JDWP
(Java Debug Wire Protocol) agent.</p>

<p>After running the commands shown below, attach your favourite debugger to port
<code>5005</code>. The JVM will suspend startup until the debugger is attached &mdash; change
<code>suspend</code> to <code>n</code> if you don&rsquo;t want this behaviour.</p>

<h3 id="debugging-installed-version-of-bloop">Debugging installed version of bloop</h3>

<p>If you want to debug your installed bloop server, first kill the server. You
can do this with, for example, <code>systemctl stop --user bloop</code> or a similar
incantation. The command to run depends on your OS and how you installed and
started the server.</p>

<p>The server is now stopped. You can run a debuggable Bloop server with either of these options:</p>

<h4 id="using-bloop-server">Using <code>bloop server</code></h4>

<pre><code class="language-bash">bloop server -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005
Listening for transport dt_socket at address: 5005
</code></pre>

<h4 id="using-java-tool-options">Using <code>JAVA_TOOL_OPTIONS</code></h4>

<pre><code class="language-bash">JAVA_TOOL_OPTIONS='-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005' bloop server
Picked up JAVA_TOOL_OPTIONS: -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005
Listening for transport dt_socket at address: 5005
</code></pre>

<h3 id="running-bloop-server-from-sbt">Running Bloop server from sbt</h3>

<p>Run the bloop server directly from sbt:</p>

<pre><code class="language-sh">$ sbt
&gt; frontend/runMain bloop.Server
</code></pre>

<p>Kill the bloop server with <kbd>Ctrl</kbd><kbd>C</kbd>.</p>

<h4 id="attaching-debugger-in-local-bloop">Attaching debugger in local bloop</h4>

<p>This is mostly useful for Bloop developers that have a local copy of bloop
they want to debug. You can debug bloop with three tools: <code>bloop</code> (if you use
it to develop <code>bloop</code>), <code>sbt</code> or <code>ensime</code>.</p>

<h5 id="bloop">bloop</h5>

<pre><code class="language-bash">bloop run frontend -- -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005
Listening for transport dt_socket at address: 5005
</code></pre>

<h5 id="sbt">sbt</h5>

<pre><code class="language-sh">$ sbt
&gt; set javaOptions in (frontend, run) += &quot;-agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005&quot;
&gt; frontend/runMain bloop.Server
Listening for transport dt_socket at address: 5005
</code></pre>

<h5 id="ensime">Ensime</h5>

<pre><code class="language-sh">$ sbt
&gt; frontend/ensimeRunDebug bloop.Server
Listening for transport dt_socket at address: 5005
</code></pre>


    
    </div>
    </div>
</main>
  <footer>   <footer id="footer">
    <nav>
      <ul>
        <li><span>Bloop</span></li>
        <li>
          <a href="/company/">Scala Center</a>
        </li>

          <li>
          <a href="/docs/">Docs</a>
        </li>
        <li>
          <a href="https://twitter.com/scala_lang">Give us a shout-out on Twitter!</a>
        </li>
      </ul>
    </nav>
    <p>&copy; Licence Apache2.</p>
  </footer> </footer>


  <script src="/bloop/js/kube.js" type="text/javascript">
  </script>
  <script src="/bloop/js/kube.legenda.js" type="text/javascript">
  </script>
  <script src="/bloop/js/master.js" type="text/javascript">
  </script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>

  
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
  <script type="text/javascript"> docsearch({
   apiKey: 'cf5bcb37b134346182da2be3f5e0a76b',
   indexName: 'bloop_scala',
   inputSelector: '#bloop-search',
   debug: false 
  });
  </script> 
</body>

</html>
